---
title: "Procurement Dynamics: Analyzing Federal Contract Awards to Microsoft"
subtitle: "Microsoft's Dominance in IT Procurement and Relationships with Government"
author: 
  - Deyi Kong
thanks: "Code and data are available at: [https://github.com/eeeee-cmd/Procurement/](https://github.com/eeeee-cmd/Procurement/)."
date: today
date-format: long
abstract: "This paper analyzes federal procurement contracts awarded to Microsoft from 2020 to 2024, focusing on contract values, categories, and relationships with key government buyers. A Bayesian modeling approach was employed to predict contract amounts. The study highlights Microsoft's significant role in securing high-value contracts and maintaining steady partnerships with major departments such as National Defence. These findings provide important trends in federal procurement, drawing attention to the potential risks of dependency on a single supplier and challenges to competition."
format: pdf
toc: true
toc-depth: 3
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

# Install Packages if not downloaded:
required_packages <- c(
  "tidyverse", "sf", "here", "arrow", "ggplot2", "janitor", "purrr", "knitr", "kableExtra", "modelsummary"
)
for (p in required_packages) {
  if (!require(p, character.only = TRUE)) {
    install.packages(p, character.only = TRUE)
  }
}

# load libraries
library(tidyverse)
library(sf)
library(dplyr)
library(here)
library(arrow)
library(ggplot2)
library(janitor)
library(purrr)
library(knitr)
library(kableExtra)
library(modelsummary)
library(ggcorrplot)
library(gridExtra)
library(rstanarm)

# load data
cleaned_data <- read_parquet(here::here("data/analysis_data/procurement_cleaned.parquet"))
```

\newpage

# Introduction

Government procurement involves the acquisition of goods and services. The construction services by the government span a wide range of purchases, from office supplies to materials and services needed for large-scale infrastructure projects [@gac]. This process enables public innovation, economic stimulus, and fulfills strategic objectives. Within this landscape, the relationship between technology providers and government operations has become increasingly prominent. Despite the growing reliance on tech giants, limited research examines the dynamics of such partnerships, particularly in the context of federal procurement contracts.

This paper aims to address this gap by analyzing federal procurement contracts awarded to Microsoft from 2020 up to September 2024. Using publicly available data from the Investigative Journalism Foundation [@IJF], the study focuses on contract values, categories, and Microsoft’s relationships with key government buyers. 

The main estimand in this study is the amount of federal procurement contracts awarded to Microsoft. This metric is analyzed across multiple dimensions, including contract categories, duration, and partnerships, to quantify Microsoft's role in federal procurement. 

A Bayesian modeling approach is employed to predict future trends in the contract amounts, integrating prior knowledge with observed data to address uncertainty and provide more robust estimates. The findings reveal that Microsoft plays a dominant role in IT infrastructure and modernization, securing most high-value contracts and establishing consistent partnerships with departments such as Employment and Social Development Canada and National Defence. These findings highlight the broader implications of the private tech sector’s influence on public sector procurement, raising questions about competitiveness, dependency, and strategic alignment.

This study contributes to understand the procurement landscape, providing valuable information for policymakers, industry stakeholders, and academics. The study  underscores the importance of transparency, strategic planning, and balancing innovation with equity in government contracts.

The structure of the paper is as follows: [@sec-data] outlines the data sources and variables considered, followed by the model setup and justifications in [@sec-mod]. The results in [@sec-result] presents the key findings of the analysis, with a discussion on the implications. [@sec-discussion] then discusses potential limitations of data, model and suggestions for future research. The appendix provides additional detailed information about models in [@sec-model-details] and methodology in [@sec-meth-details].

# Data {#sec-data}

## Overview

The data used in this analysis comes from publicly available procurement data [@IJF]. The analysis uses the statistical programming language R [@citeR] and several libraries, including `tidyverse` [@tidyverse], `janitor` [@janitor], `knitr` [@knitr], `dplyr` [@dplyr], `arrow` [@arrow], `purrr` [@purrr], and `here` [@here] for data manipulation. `ggplot2` [@ggplot] and `kableExtra` [@kableExtra] for visualization. The dataset covers the information of chosen Federal Procurement Supplier - Microsoft - capturing the contracts from 2020 to 2024 (up to September). 

## Measurement

The dataset used in this analysis originates from Canadian governments of all levels post solicitations for companies to search for business opportunities, as documented in @ProcurementIntro. The data from these various platforms is then standardized to form a unified dataset for analysis.

The measurement process delegates contracts routed through Public Service and Procurement Canada (PSPC), and blanket disclosures organized by Treasury Board of Canada Secretariat (TBS) to understand the federal procurement. The methodologies of federal solicitations are either competitive or non-competitive. Competitive contracts allow bids from all or a subset of suppliers, while non-competitive contracts are awarded without open bidding. Exceptions for non-competitive contracts include situations where delays could harm the public interest or when the cost to the buyer falls below certain thresholds for specific goods or services.

More detailed information about solicitation methodology can be found in @sec-meth-details.


## Data Cleaning

After importing the raw dataset using `read_csv` function, I first select specific columns to focus on relevant information for this study by omitting redundant information, such as the contract link and the same value of region. Then I rename key variables from the raw data for clarity. The key variables of interest in this analysis include $Contract$, $StartDate$, $AwardDate$, $EndDate$, $Buyer$, and $Amount$.

I standardize the date format of all date-related data for proper parsing by using `mdy()` function and change the dollar format of the amount into numeric numbers for future calculation purposes. Due to the error with the unknown reason that $EndDate$ is before $StartDate$ or $AwardDate$, those entries were excluded from this paper. 

$PreparatoryPhase$, $PhaseDays$, and $ContractDays$ variables were created to analyze the preparatory phase and performance phase corresponding to each contract. $PreparatoryPhase$ calculates the days from $AwardDate$ to $StartDate$. $ContractDays$ calculates the days from $StartDate$ to $EndDate$. $PhaseDays$ takes the absolute value of $PreparatoryPhase$ because of the minor effect of either preparing before the contract is awarded or preparing after the contract is awarded. I also created new variables called $ContractType$ and $BuyerCleaned$, which categorize the most common buyers and contracts based on keywords.

This dataset contains only two entries for 2019 federal procurement contracts awarded to Microsoft. So, I filtered out the contracts before 2020 to focus on the records between 2020 and September 2024 as desired. Also, I filtered missing data (NA) of $StartDate$, which only has one entry in this dataset. By summary of the data set, I noticed a significant outlier with the value of $102,260,150, which largely impacted the outcome. So, I decided to drop this entry. Then I check the character type variables, $Supplier$ and $Contract$, using `table()` function to manipulate input error. I standardize the supplier's name which combines the similar name due to capitalization or some notation differences, and format them with the first letter of each word capitalized.

After completing the cleaning, we saved the final dataset in both Parquet and CSV formats for later analysis.

## Outcome Variables

The main outcome variable of interest is the amount of federal procurement contracts awarded to Microsoft. This variable is needed to represent the financial magnitude of Microsoft with the federal government and the measurement of evaluating procurement dynamics. [@fig-amount] is a histogram, which illustrates the annual total amounts of federal procurement contracts awarded to Microsoft from 2020 to 2024 (up to September). [@fig-amount] shows a generally increasing trend of the total value of each year's contract. This may reflect the growth of technology in government operations, including software, cloud solutions, and IT infrastructure. The amount in 2023 doubles the amount in 2021, which suggests a heightened investment in federal procurement funding and large-scale projects. 

```{r}
#| label: fig-amount
#| fig-cap: The histogram shows the distribution of the total amount ($million) of each year's federal contract (since 2020).
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Extract year from AwardDate and filter the year from 2020 to 2024
year_data <- cleaned_data %>%
  mutate(
    Year = as.integer(format(as.Date(AwardDate), "%Y"))
    )

# Sum the total amount group by year
yearly_amount <- year_data %>%
  group_by(Year) %>%
  summarize(TotalAmount = sum(Amount, na.rm = TRUE)) %>%
  mutate(TotalAmount = round(TotalAmount / 1000000)) # Convert to millions

# Plot the amount in each year
ggplot(yearly_amount, aes(x = as.factor(Year), y = TotalAmount)) +
  geom_bar(stat = "identity", fill = "darkorange", color = "black", alpha = 0.7) +
  labs(
    title = "Total Contract Amounts by Year for Microsoft",
    x = "Year",
    y = "Total Amount ($million)"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 8), 
    axis.title.y = element_text(size = 10),
    axis.title.x = element_text(size = 10),
    axis.text.x = element_text(size = 8),
    plot.title = element_text(size = 12)
    )

```

\newpage

## Predictor Variables

In this analysis, several key predictors were identified to evaluate procurement data effectively. 

**ContractType**, is a character-type variable that identifies each procurement contract awarded to Microsoft into Categories. License/Maintenance Fees has the highest number of contracts (495) in [@tbl-contract], suggesting the recurring need for software and system maintenance. Computer Services has the highest average contract value (\$1,763,432) in [@tbl-contract], reflecting the complexity and scope of IT services. Database Access Services also shows significant average values (\$1,680,453), indicating the importance of large-scale data systems in government operations.

```{r}
#| label: tbl-contract
#| tbl-cap: The table summarizes the contract type which has over 25 contracts with the total dollar amount, and average dollar amount per contract. 
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Summarize the data and filter buyers with counts >= 25
summary_table <- cleaned_data %>%
  group_by(ContractType) %>%
  summarise(
    Count = n(), 
    TotalAmount = sum(Amount),  # Calculate the total contract value
    AvgAmount = mean(Amount)    # Calculate the average contract value
  ) %>%
  filter(Count > 25) %>%
  arrange(desc(Count))  # Arrange in descending order based on Count

# Format the TotalAmount column with dollar format
summary_table$TotalAmount <- scales::label_dollar()(summary_table$TotalAmount)
summary_table$AvgAmount <- scales::label_dollar()(summary_table$AvgAmount)

# Display the summary table using kableExtra for nicer formatting
summary_table %>%
  kable(col.names = c("Contract Type", "Counts", "Total Amount", "Average")) %>%
  kable_styling(full_width = F, position = "center", bootstrap_options = c("striped", "hover")) %>%
  column_spec(1, width = "22em")  # Set column width to wrap text

```

**Buyer** is a character-type variable representing the federal government department or agency that initiates and awards the contract. [@tbl-buyer] shows the buyer who has over 25 contracts with Microsoft, which identifies key partners and understands the distribution of contracts across sectors. The table highlights that Employment and Social Development Canada (ESDC) and National Defence account for over 50% of Microsoft's total awards.

```{r}
#| label: tbl-buyer
#| tbl-cap: The table summarizes top 10 buyers with contract count, total dollar amount, and average dollar amount per contract. 
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Summarize the data and filter buyers with counts >= 25
summary_table <- cleaned_data %>%
  group_by(Buyer) %>%
  summarise(
    Count = n(), 
    TotalAmount = sum(Amount),  # Calculate the total contract value
    AvgAmount = mean(Amount)    # Calculate the average contract value
  ) %>%
  filter(Count > 25) %>%
  arrange(desc(Count))  # Arrange in descending order based on Count

# Format the TotalAmount column with dollar format
summary_table$TotalAmount <- scales::label_dollar()(summary_table$TotalAmount)
summary_table$AvgAmount <- scales::label_dollar()(summary_table$AvgAmount)

# Display the summary table using kableExtra for nicer formatting
summary_table %>%
  kable(col.names = c("Buyer", "Contract", "Total Amount", "Average")) %>%
  kable_styling(full_width = F, position = "center", bootstrap_options = c("striped", "hover")) %>%
  column_spec(1, width = "22em")  # Set column width to wrap text

```

This dataset contains a series of date-type variables capturing key milestones in the procurement process. **Award Date** is the date when the contract was officially granted to Microsoft. **Start Date** is the date when the contracted services or goods provision begins. **End Date** is the date when the contract is completed or terminated. These variables are essential for analyzing procurement timelines and trends over the study period.

**PhaseDays** is a numeric variable that demonstrates the days between AwardDate and StartDate. In [@fig-preparatory], there is a high concentration of around 0 indicates rapid procurement processes or emergency software services. [@fig-preparatory] also shows a few outlying contracts with a mobilization period of over one year. These long mobilization periods reflect issues such as delays in the procurement process, a long negotiation period, or administrative approvals.

```{r}
#| label: fig-preparatory
#| fig-cap: The histogram shows the distribution of preparatory period.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# create plot for Distribution of Poll Scores by candidate
ggplot(cleaned_data, aes(x = PhaseDays)) +
  geom_histogram(
    bins = 30,
    fill = "salmon",
    color = "black",
    alpha = 0.7
  ) +
  labs(
    x = "Preparatory Phase (day)",
    y = "Frequency"
  ) +
  theme_minimal()
```

\newpage

**ContractDays** is a numeric variable which is the days between $StartDate$ and $EndDate$. [@fig-contract] shows the distribution of the performance period. The right-skewed distribution in [@fig-contract] indicates that the majority of contract duration is within a year. There is an over 5 years performance period in [@fig-contract] implies a massive project that requires extensive preparation.

The correlation matrix in [@fig-cor] visualizes the relationships between key numerical predictor variables and the outcome variable, $Amount$. [@fig-cor] shows correlations include a weak negative correlations between $PreparatoryPhase$ and $ContractDays$; and weak positive correlations between predictors and $Amount$.

More information about data analysis and figures are displayed in @sec-data-visualization.


# Model {#sec-mod}

## Model Set-Up {#sec-modset}

This paper utilizes a Bayesian model to examine the factors influencing the dollar amount of federal procurement contracts awarded to Microsoft. Define $Amount_i$ as the dollar amount of the federal procurement contract awarded to Microsoft and $\mu_i$ is the expected value of the contract amount modeled as a linear combination of the predictors. The model for predicting $Amount_i$ is specified as follows:
\begin{align*} 
Amount_i \mid \mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma)\\
\mu_i &= \alpha + \beta_1 \cdot \text{ContractType}_i + \beta_2 \cdot \text{Buyer}_i + \beta_3 \cdot \text{ContractDays}_i + \beta_4 \cdot \text{PhaseDays}_i \\
\alpha &\sim \text{Normal}(0, 2) \\
\beta_1, \beta_2, \beta_3, \beta_4 &\sim \text{Normal}(0, 2) \\
\sigma &\sim \text{Exponential}(1)
\end{align*}
Where:\
- $\alpha$ is the intercept term.\
- $\beta_1, \beta_2, \beta_3, \beta_4$ are the coefficients associated with the predictors:\
  - $ContractType_i$: A categorical variable representing the contract type.\
  - $Buyer_i$: A categorical variable representing the buyer of the contract.\
  - $ContractDays_i$: A numeric variable representing the duration of the contract is active.\
  - $PhaseDays_i$: A numeric variable representing the days between AwardDate and StartDate.

The model is fit using the `rstanarm` package of @rstanarm in R [@citeR], with the specified priors guiding the model while allowing it to adapt to the data.

### Model Justification
This paper expect that the factors - such as $ContractType$, $Buyer$, $ContractDays$ and $PhaseDays$ - will influence the outcome of contract amount. In particular, $ContractType$ captures the service or product, such as software licenses or consulting services, which significantly influences contract value. $Buyer$ reflects the federal department or agency awarding the contract, as some departments have higher budgets and strategic priorities that result in larger contracts. $ContractDays$ and $PhaseDays$ quantify the duration and preparatory timelines of contracts, providing insight into their scope and complexity.

In this paper, I compared linear regression and Bayesian regression to examine the factors influencing the federal procurement contract amount. Each of these models offers different advantages and trade-offs. More detailed justification about model selection will be discussed in [@sec-discussion]. The Bayesian model is selected due to better performance and flexibility.

Bayesian approach can explicitly model uncertainty by incorporating prior knowledge and provides a full posterior distribution of the model parameters. This is useful when the data is sparse and prior knowledge about the contract types, buyers, or duration is available. The linear regression structure was selected due to its simplicity and interpretability. The numeric dependent variable, $Amount_i$, gives a chance of linear regression for modeling the relationship between the contract amount and its predictors. 

By including weakly informative priors for the coefficients and residual standard deviation, the model remains flexible and interpretable, while still preventing extreme parameter estimates. The use of an exponential prior for $\sigma$ allows the model to adapt a scale of residuals in the data, providing estimates of the variance. The normal prior for the coefficients $\beta_1, \beta_2, \beta_3, \beta_4$ with mean 0 and standard deviation 2 shows the expectation that the coefficients should not be too larg but flexible enough to adapt the data.

This Bayesian regression model balances complexity with interpretability, and its flexibility with quantifying uncertainty around the estimates, especially when the sample size is not large and the predictors have a complex relationship with the outcome.

## Assumptions and Limitations

The model takes several assumptions, including linear relationship between predictors, normality of the residuals, independence of observations, homoscedasticity, and reasonable chosen priors.

While the model presents some valuable observations of Microsoft’s federal procurement contracts, there are some model limitations including prior function selection, data quality, potential for endogeneity, generalizability, and unobserved variables. These limitations will be discussed more detailed in [@sec-discussion-model].

# Results {#sec-result}

The results are summarized in @tbl-modelresults, including R², Log-Likelihood (Log.Lik.), Expected Log Pointwise Predictive Density (ELPD), Leave-One-Out Information Criterion (LOOIC), Watanabe-Akaike Information Criterion (WAIC), and Root Mean Square Error (RMSE).

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

bayesian_model <-
  readRDS(file = here::here("models/bayesian_model.rds"))
```

```{r}
#| label: tbl-modelresults
#| echo: false
#| eval: true
#| tbl-cap: "Summary of explanatory models for predicting contract amounts."
#| warning: false
#| message: false

# Generate the model summary

bayesian_model_full <- readRDS(here::here("models/bayesian_model_full.rds"))
bayesian_model <- readRDS(here::here("models/bayesian_model.rds"))

model_list <- list("Bayesian Model_Full" = bayesian_model_full, "Bayesian Model" = bayesian_model)

modelsummary(
  model_list,
  output = "kableExtra", 
  coef_map = c("ContractType" = "ContractType", "Buyer" = "Buyer", 
               "ContractDays" = "ContractDays", "PhaseDays" = "PhaseDays")
) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

The table compares two Bayesian models: the full model, `Bayesian Model_Full`, which includes all predictors (e.g., $Contract$, $Buyer$, $ContractDays$, and $PhaseDays$); and a simplified model, `Bayesian Model`, that adjusts for reduced predictors' complexity (e.g., $ContractType$, $BuyerCleaned$, $ContractDays$, and $PhaseDays$). Coefficients represent the estimated effect of each predictor on the contract amount, with credible intervals reflecting uncertainty. The results highlight the influence of contract-specific and buyer-specific variables on procurement amounts.

The Full Bayesian Model has an $R^2$ of 0.289, indicating that approximately 28.9% of the variance in the contract amount is explained by the model. In comparison, the Reduced Bayesian Model explains only 8.2% of the variance in the contract amount, suggesting that the inclusion of additional predictors (specific buyers and contract names) improves the model’s explanatory power. However, both models have very low adjusted $R^2$, which suggests that the model is not capturing much of the unexplained variance in the data.

The Full Bayesian Model has a Log-Likelihood of $-15,351.795$ and an ELPD of $-15,519.3$, while the Reduced Model has a Log-Likelihood of $-15,398.022$ and an ELPD of $-15,444.8$. These values suggest that the Full Bayesian Model fits the data slightly better than the Reduced Model, as it produces higher Log-Likelihood and ELPD values.
 
The Full Bayesian Model has a lower LOOIC ($31,038.7$) and WAIC ($30,992.3$) compared to the Reduced Model, indicating that the Full Bayesian Model is better at out-of-sample predictive performance. Lower values of LOOIC and WAIC are indicative of better model fit and predictive accuracy.

The Full Bayesian Model has a lower RMSE ($2,714,467.04$) compared to the Reduced Model ($2,971,135.35$), indicating better predictive performance. The lower RMSE value suggests that the Full Bayesian Model is more accurate in predicting the total contract amount.

More results about the Bayesian model can be found in @sec-model-details.

\newpage

# Discussion {#sec-discussion}

## Contract Complexity and Cost
The positive association between $ContractDays$ and contract amount suggests that longer contracts tend to be more expensive. This pattern likely reflects the increased scope, complexity, and resource demands of these agreements, which are particularly prominent in IT-related contracts. These contracts often require ongoing development, maintenance, and support, making them more costly over time. Understanding this relationship helps stakeholders anticipate the financial requirements of long-term contracts and make more informed decisions when negotiating the terms of such agreements.

## Negotiation and Efficiency
The negative association between $PhaseDays$ and contract amount suggests that longer planning and negotiation periods may be associated with lower costs. This could be attributed to more thorough upfront planning, strategic negotiation, and budget management, which might lead to better cost control. For procurement agencies, this finding highlights the potential for improving procurement efficiency by streamlining the preparation phase. It also emphasizes the importance of early planning in securing cost-effective contracts, which can ultimately benefit both suppliers and government departments.

## Sector-Specific Effects 
The significant variation in contract amounts across different contract types (e.g., Consulting, Software) and buyers (e.g., National Defence, Employment and Social Development Canada) underscores the importance of sector-specific factors in federal procurement dynamics. Departments with higher budgets or those managing critical projects, such as National Defence, tend to award larger contracts. This observation suggests that the size and nature of the buyer's mandate play a substantial role in shaping procurement patterns. It also indicates that procurement decisions are not solely based on market competitiveness but are influenced by the strategic priorities of the departments involved.

## Model Performance and Limitations {#sec-discussion-model}

The Bayesian model used in this study has low adjusted $R^2$ values, indicating that it explains only a small portion of the variance in contract amounts (28.9%). This suggests that other important predictors, not captured by the model, may be influencing contract outcomes. The presence of missing or erroneous values in key variables like $ContractDays$ or $PhaseDays$ may introduce bias, further reducing the model's reliability.

One notable limitation of the model is its inability to account for external factors that could significantly affect procurement decisions, such as political influences, departmental priorities, or budgetary constraints. These unobserved variables may introduce omitted variable bias, affecting the model's accuracy. Furthermore, the model assumes linear relationships between the independent variables and the dependent variable, which oversimplifies the complex nature of federal procurement. The categorization of contract types and buyers into broad groups also limits the model's ability to capture the full diversity of contracts awarded.

Endogeneity is another issue that may affect the model's findings. There may be a bidirectional relationship between procurement amounts and buyer behavior—future procurement amounts could influence the allocation of future budgets, which in turn may impact future contracts awarded to Microsoft. This reciprocal relationship, if not properly addressed, can lead to biased coefficient estimates.

## Weaknesses and Next Steps

This paper provides a foundation for understanding federal procurement contracts awarded to Microsoft but also suggests several directions for future research. One potential extension of this study is to compare Microsoft's procurement trends with those of other major suppliers. By analyzing whether Microsoft's patterns are unique or consistent with broader trends across industries, researchers could better assess whether the observed dynamics are systemic within federal procurement practices.

Additionally, the data quality issues identified—such as incomplete or inconsistent contract dates—highlight the need for improved data reporting standards. These inconsistencies could be addressed through collaboration with government agencies to ensure that future procurement datasets are more accurate and reliable. This would enhance the validity of future analyses and make procurement data more actionable for both policymakers and industry stakeholders.

Finally, exploring more complex models, such as non-linear regression or machine learning approaches, could provide deeper insights into the factors influencing contract amounts. These methods may offer more flexibility in capturing non-linear relationships and uncovering hidden patterns within the data, improving the robustness and predictive power of the analysis.

\newpage

\appendix

# Appendix {-}

# Additional Data details {#sec-data-details}

## Graphs {#sec-data-visualization}
```{r}
#| label: fig-contract
#| fig-cap: The histogram shows the distribution of performance period, which demonstrates the days between start and end date.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# create plot for Distribution of Poll Scores by candidate
ggplot(cleaned_data, aes(x = ContractDays)) +
  geom_histogram(
    bins = 15,
    fill = "steelblue",
    color = "black",
    alpha = 0.7
  ) +
  labs(
    x = "Contract Performance Phase (day)",
    y = "Frequency"
  ) +
  theme_minimal()
```

```{r}
#| label: fig-cor
#| fig-cap: Correlation matrix showing the relationships between numerical predictor variables and the outcome Amount variable
#| echo: false
#| eval: true
#| warning: false
#| message: false

# filter to numerical predictor variables
numerical_data <- cleaned_data %>%
  select(Amount, PreparatoryPhase, ContractDays)

correlation_matrix <- cor(numerical_data, use = "complete.obs")

# create correlation matrix
ggcorrplot(correlation_matrix, lab = TRUE) + 
  theme(
    axis.text.x = element_text(size = 10),  # Adjust x-axis text size
    axis.text.y = element_text(size = 10) # Adjust y-axis text size
  )
```

```{r}
#| label: fig-box
#| fig-cap: The Boxplots shows the relationship of ContractDays and PhaseDays with ContractType. 
#| fig-subcap: ["Contract Duration in each Contract Type","Phase Duration in each Contract Type"]
#| echo: false
#| warning: false
#| layout-nrow: 2

# Clean and transform the data
data <- cleaned_data %>%
  mutate(
    ContractType = gsub("Related", "", ContractType), # Remove "Related"
    ContractType = str_wrap(gsub("/", " or ", ContractType), width = 10) # Wrap long labels
  )

# First graph: ContractType vs. ContractDays
ggplot(data, aes(x = ContractType, y = ContractDays)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = "Contract Type", y = "Contract Duration") +
  theme(axis.text.x = element_text(size = 6))

# Second graph: ContractType vs. PhaseDays
ggplot(data, aes(x = ContractType, y = PhaseDays)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = "Contract Type", y = "Phase Duration") +
  theme(axis.text.x = element_text(size = 6))
```

\newpage

## Data Visualization Analysis

The boxplot @fig-box-1 shows the Contract Duration across various Contract Types. As we can see in @fig-box-1, Computer Services, and Consulting contracts tend to have longer durations. This suggests these contracts often involve more complex or ongoing services that require extended timelines. In contrast, License/Maintenance Fees and Software contracts show shorter durations, with tighter interquartile ranges and lower medians, indicating that these contracts are likely less complex and are typically limited to a defined period. 

The boxplot @fig-box-2 shows the Phase Duration for each Contract Type. @fig-box-2 highlights Consulting and Distributed Computing Environments have longer preparatory phases, with a higher median and a larger spread. This suggests these contracts require more time for negotiation, planning, or administrative procedures before the actual work begins. On the other hand, Computer Services and License/Maintenance Fees contracts exhibit shorter preparatory phases, as evidenced by the lower medians and narrower interquartile ranges in @fig-box-2. This suggests that these contracts are more straightforward and may require less preparation before implementation.

The heatmap @fig-date shows the distribution of federal procurement contracts awarded to Microsoft over four-month periods from 2020 to 2024. The frequency tends to drop in the September–December period, which suggests the budgetary constraints or the fiscal year-end.
A noticeable decline occurs in 2024 because the data only updates until September. The darker shades during early and mid-year in @fig-date align with expected procurement trends, where departments allocate funds proactively before the fiscal year closes. Understanding this distribution provides critical insights into procurement planning and Microsoft's role during different periods.

```{r}
#| label: fig-date
#| fig-cap: Heatmap of Contracts by Four-Month Periods (2020–2024). The heatmap shows the frequency of federal procurement contracts awarded to Microsoft in each four-month period, with darker colors representing higher contract frequencies.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Create a new variable for "four-month periods"
data <- cleaned_data %>%
  mutate(
    Period = case_when(
      Month %in% 1:4 ~ "Jan-Apr",
      Month %in% 5:8 ~ "May-Aug",
      Month %in% 9:12 ~ "Sep-Dec"
      )
  )

# Count the number of contracts for each four-month period and year
contract_counts <- data %>%
  mutate(Year = as.factor(Year)) %>%
  group_by(Year, Period) %>%
  summarise(Count = n(), .groups = "drop")

# Heatmap plot
ggplot(contract_counts, aes(x = Period, y = Year, fill = Count)) +
  geom_tile(color = "white") +  # Add color between tiles for better visibility
  scale_fill_gradient(low = "lightblue", high = "darkblue") +  # Adjust color scale
  labs(x = "Four-Month Period", y = "Year", title = "Heatmap of Contracts by Four-Month Periods") +
  theme_minimal()
```

The scatter plot @fig-mobilization shows the relationship between the Award Date and the Start Date of federal procurement contracts awarded to Microsoft. Most points lie on the diagonal line indicating the numerous contracts commence immediately after being awarded. This is particularly common for time-sensitive contract types, such as License/Maintenance Fees Related. Contracts in 2020–2021 tend to exhibit a wider spread in start dates, possibly reflecting a slower procurement process during those years. More recent contracts in @fig-mobilization cluster closer to the diagonal, suggesting streamlined processes or more immediate implementation needs.

```{r}
#| label: fig-mobilization
#| fig-cap: The scatter plot shows the relationship between Award Date and Start Date for the top 10 federal procurement contracts types. Each point represents a contract, with colors indicating different contract types. The plot helps to identify trends in the timing between contract award and commencement.
#| echo: false
#| eval: true
#| warning: false
#| message: false

ggplot(
  data, 
  aes(x = AwardDate, y = StartDate)) +
  geom_point(aes(color = ContractType)) +
  labs(x = "Award Date", y = "Start Date", title = "Award Date vs Start Date") +
  theme(
    legend.position = "right",
    legend.text = element_text(size = 6),      # Adjust legend label size
    legend.title = element_text(size = 8),     # Adjust legend title size
    axis.text.x = element_text(size = 6),      # Adjust x-axis text size
    axis.text.y = element_text(size = 6),      # Adjust y-axis text size
    )  # This removes the legend
```

The scatter plot @fig-performance shows the diversity in contract durations across procurement categories. Most contracts end within one year of their start dates, suggesting that most federal contracts are short-term. A smaller subset of contracts extends beyond three years, typically associated with large-scale projects or ongoing support agreements. @fig-performance also highlights that most contract ends in the year 2026. A few contracts with over 5 years stand out in 2021, suggesting that longer durations are prevalent in service-oriented categories.

```{r}
#| label: fig-performance
#| fig-cap: The scatter plot shows the relationship between Start Date and End Date for the top 10 Microsoft’s federal procurement contracts types. Each point represents a contract, and the color reflects the contract type. This visualization provides insights into the duration of the contracts and any deviations from expected timelines.
#| echo: false
#| eval: true
#| warning: false
#| message: false

ggplot(
  data, 
  aes(x = StartDate, y = EndDate)) +
  geom_point(aes(color = ContractType)) +
  labs(x = "Start Date", y = "End Date", title = "Start Date vs End Date") +
  theme(
    legend.position = "right",
    legend.text = element_text(size = 6),      # Adjust legend label size
    legend.title = element_text(size = 8),     # Adjust legend title size
    axis.text.x = element_text(size = 6),      # Adjust x-axis text size
    axis.text.y = element_text(size = 6),      # Adjust y-axis text size
  )
```

# Additional Model details {#sec-model-details}

## Bayesian Model

### Posterior Predictive Check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check, comparing the observed data, $y$ and the posterior predictive replicated data $y_{rep}$. This shows how well the Bayesian model replicates the observed data. @fig-ppcheckandposteriorvsprior-1 displays a pronounced spike at 0, where $y$ has a significantly higher frequency of values at $0e+00$ compared to the predictions from the model. This discrepancy indicates that the model fails to accurately capture the concentration of contracts with a value of exactly zero or near-zero, potentially due to missing covariates or unmodeled structural factors influencing the occurrence of zero-value contracts.

The predicted distribution $y_{rep}$ in @fig-ppcheckandposteriorvsprior-1 aligns more closely with the observed data at larger values, suggesting that the model performs well in capturing the behavior of non-zero contract amounts. However, the inability to replicate the sharp peak at 0 highlights a significant limitation in the model’s ability to account for zero-value contracts or extreme sparsity in the data. This suggests a potential need for refinements, such as incorporating a zero-inflated component or additional predictors to explain this phenomenon.

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows the influence of the observed data on parameter estimates. For most parameters, the posterior distributions are narrower and shifted away from the priors, indicating that the data provides substantial information to update the prior beliefs. Some parameters, however, show minimal deviation from their priors, which may suggest either weak data informativeness or a lack of association with the response variable.

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits and affected by the data"
#| fig-subcap: ["Posterior Prediction Check", "Comparing the Posterior with the Prior"]

pp_check(bayesian_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(bayesian_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set3") +
  theme(
    legend.position = "none", 
    axis.text.y = element_text(size = 7)
    ) +
  coord_flip() 
```

### Diagnostics

@fig-trace-1 is a trace plot related to $ContractType$. Each chain shows the sampled values of the parameters over the iterations of the Markov Chain Monte Carlo (MCMC) process. The chains for all contract type parameters appear to mix well and fluctuate around a consistent range, indicating convergence. There is no evidence of trends or drifts in the chains, which suggests that the MCMC process effectively explores the posterior distribution.

@fig-trace-2 is a trace plot associated with $Buyers$. Similar to @fig-trace-1, the plot shows the sampled parameter values for multiple MCMC chains over iterations. The chains in @fig-trace-2 for most buyer parameters exhibit good mixing and stability, with fluctuations around a consistent range. This indicates effective convergence for the majority of buyer-related parameters. A few parameters in @fig-trace-2 exhibit slightly slower mixing, but they still stabilize, suggesting no major convergence issues.

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-trace
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot - Contract Type","Trace plot - Buyers"]
#| layout-nrow: 2

# Extract the parameter names
param_names <- colnames(as.matrix(bayesian_model))

# Use grep to find all parameters that contain "ContractType"
contract_type_params <- grep("ContractType", param_names, value = TRUE)

# Use grep to find all parameters that contain "Buyer"
buyer_params <- grep("Buyer", param_names, value = TRUE)

# # Group 1: Buyers containing the word "the"
# buyers_with_the <- grep("the", buyer_params, value = TRUE, ignore.case = TRUE)
# 
# # Group 2: Buyers containing the word "the"
# buyers_with_and <- grep("and", buyer_params, value = TRUE, ignore.case = TRUE)
# buyers_with_and <- buyers_with_and[!grepl("the", buyers_with_and, ignore.case = TRUE)]
# 
# # Group 3: Buyers containing the word "the"
# buyers_with_of <- grep("of", buyer_params, value = TRUE, ignore.case = TRUE)
# buyers_with_of <- buyers_with_of[!grepl("the|and", buyers_with_of, ignore.case = TRUE)]
# 
# # Group 4: Buyers containing the word "Canada"
# buyers_with_canada <- grep("Canada", buyer_params, value = TRUE, ignore.case = TRUE)
# buyers_with_canada <- buyers_with_canada[!grepl("the|and|of", buyers_with_canada, ignore.case = TRUE)]
# 
# # Group 5: Buyers that do not contain "the" or "Canada"
# other_buyers <- grep("Canada|the|and|of", buyer_params, value = TRUE, invert = TRUE, ignore.case = TRUE)

# Plot trace for ContractType
plot(bayesian_model, "trace", pars = contract_type_params) +
  theme_minimal() +
  theme(
    legend.position = "bottom",                # Place legend at the bottom
    legend.text = element_text(size = 6),      # Adjust legend label size
    legend.title = element_text(size = 8),     # Adjust legend title size
    axis.text.x = element_text(size = 6),      # Adjust x-axis text size
    axis.text.y = element_text(size = 6),      # Adjust y-axis text size
    strip.text = element_text(size = 5)
    )

# Plot trace for ContractType
plot(bayesian_model, "trace", pars = buyer_params) +
  theme_minimal() +
  theme(
    legend.position = "bottom",                # Place legend at the bottom
    legend.text = element_text(size = 6),      # Adjust legend label size
    legend.title = element_text(size = 8),     # Adjust legend title size
    axis.text.x = element_text(size = 4),      # Adjust x-axis text size
    axis.text.y = element_text(size = 5),      # Adjust y-axis text size
    strip.text = element_text(size = 5)
    ) 

# # Plot trace for buyers' name containing "the"
# plot(bayesian_model, "trace", pars = buyers_with_the)
# 
# # Plot trace for buyers' name containing "and"
# plot(bayesian_model, "trace", pars = buyers_with_and)
# 
# # Plot trace for buyers' name containing Canada
# plot(bayesian_model, "trace", pars = buyers_with_canada)
# 
# # Plot trace for buyers' name containing "of"
# plot(bayesian_model, "trace", pars = buyers_with_of)
# 
# # Plot trace for Other buyers
# plot(bayesian_model, "trace", pars = other_buyers)
```

@fig-rhat is Rhat plot. An Rhat value of 1.0 indicates that the MCMC chains have converged, meaning they are sampling from the same posterior distribution. If the Rhat value exceeds 1.05, it signals potential issues with convergence, indicating that the chains might not have mixed properly or that there is insufficient sampling to reach stable parameter estimates.

@fig-rhat-1 is a Rhat plot for the Full Bayesian model. The Rhat values for most parameters are around 1.0, which suggests that convergence has been achieved for the majority of parameters. There are no parameters with Rhat values exceeding 1.05, indicating that the model's convergence is sound.

@fig-rhat-2 is a Rhat plot for the reduced Bayesian model, which shows similar results. All parameters having Rhat values close to 1.0, further confirming that convergence is achieved across both models. There are no parameters with Rhat values exceeding 1.05, which supports the reliability of sampling process.

```{r}
#| label: fig-rhat
#| echo: false
#| eval: true
#| fig-cap: "Rhat plot for bayesian model"
#| message: false
#| warning: false
#| fig-subcap: ["Rhat plot - Full model","Rhat plot - Reduced model"]
#| layout-ncol: 2

plot(bayesian_model_full, "rhat")
plot(bayesian_model, "rhat")
```

\newpage

## Linear Regression Model

The linear regression model is the most straightforward and interpretable among the models considered. It assumes a linear relationship between the outcome variable, $Amount$, and predictor variables - $Contract$, $Buyer$, $ContractDays$, $PhaseDays$. This makes it easy to understand how each predictor influences the contract amount. In @tbl-linear, linear regression model achieved an R² value of 0.220, shows that only 22% of the variance in contract amounts is explained by the predictors. The Root Mean Square Error (RMSE) was approximately \$2.71 million for the full model, indicating substantial prediction errors. 

Linear regression models are computationally inexpensive and require fewer resources compared to more complex models like random forests or Bayesian regression.

```{r}
#| label: tbl-linear
#| tbl-cap: Summary of key model estimates for Microsoft, including coefficients for numeric predictors like Contract Days and Phase Days, with standard errors for each estimate. Model performance statistics, such as sample size, R², and adjusted R², are also displayed.
#| echo: false
#| eval: true
#| warning: false
#| message: false

# load data and model
lm_model <- readRDS(here::here("models/lm_model.rds"))

modelsummary(
  list("Linear Model" = lm_model),
  output = "kableExtra", 
  statistic = "std.error", 
  coef_map = c("ContractType" = "ContractType", "Buyer" = "Buyer", 
               "ContractDays" = "ContractDays", "PhaseDays" = "PhaseDays")
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down"))
```

\newpage

# Methodology {#sec-meth-details}

The methodology employed in this study focuses on analyzing federal procurement contracts awarded to Microsoft. The dataset used in this analysis comes from various Canadian government platforms that post solicitations for business opportunities, enabling companies to bid on government contracts. This data is gathered from multiple government sources and consolidated into a unified format to ensure consistency and comprehensiveness.

The analysis relies on two primary data sources: Public Services and Procurement Canada (PSPC) and the Treasury Board of Canada Secretariat (TBS). Each dataset provides unique insights into the federal procurement process, but they come with distinct limitations that must be considered when interpreting the results [@ProcurementSources].

## Data Sources and Structure

Federal procurement data is categorized into two main streams:

### Public Services and Procurement Canada (PSPC)

PSPC serves as the central procurement body for most federal government departments, overseeing a significant portion of federal contracts. It manages the CanadaBuys platform, where procurement information is publicly published. However, due to the migration from the older BuyAndSell platform and incomplete records prior to 2022, some contract details, such as contract types and trade agreement information, may be missing or inconsistently reported. The PSPC dataset is valuable for understanding the procurement contracts managed by PSPC, though it only includes contracts above a certain dollar threshold.

### Treasury Board of Canada Secretariat (TBS)

TBS consolidates procurement data from all government departments, requiring proactive publication under the Access to Information Act. Unlike PSPC, the TBS dataset covers a larger number of contracts, including those from various departments and ministries. However, some records in this dataset, especially those prior to 2017, should not be considered complete, and there are inconsistencies in the fields reported. The TBS data provides full details of contract awards but lacks tender or solicitation information, limiting its use for certain types of analysis.

## Data Integration and Challenges

One of the key challenges of this study is the overlap between the PSPC and TBS datasets. Many contracts reported by PSPC are also present in the TBS dataset. However, these two datasets do not always match perfectly. Differences in contract details, such as award amounts, contract types, or buyer names, can make direct comparisons difficult.

A significant issue is the lack of a consistent unique identifier across the two datasets, which would allow for easy linking of records. While approximately 20% of PSPC contracts have matching records in TBS, a large proportion do not, complicating the merging of the datasets. In this study, the two datasets were kept separate to preserve the integrity of each source. The PSPC data was used primarily for its comprehensive tender information, while the TBS dataset provided a broader scope of contracts, covering a longer time period and more contracts overall.

## Solicitation Methods and Contract Types

Federal procurement processes are governed by various solicitation methods, which determine how contracts are awarded. These methods are categorized into competitive and non-competitive processes. 

### Competitive Solicitation Methods

1. Open bidding: Any supplier can bid in response to an online solicitation.
2. Selective tendering: Only some prequalified suppliers can bid.
3. Limited tendering: Deviation from requirements of the relevant trade agreements (see Trade Agreements), still allowing bids.
4. Traditional: Many suppliers can bid but not in response to a public, online solicitation; for example, responding to an email sent to suppliers by the government.

### Non-Competitive Solicitation Methods

1. Advanced Contract Award Notice: Notice to suppliers that the buyer intends to award a contract to a pre-identified supplier, while accepting a Statement of Capabilities, not a bid, from challenging suppliers. 
2. Non-competitive: Blanket category for all other non-competitive processes.


\newpage

# Survey

**Vendor Relationship Dynamics in Federal Procurement**

**Introduction**

We are conducting a survey to better understand the dynamics of vendor relationships in federal procurement processes, particularly with major technology providers like Microsoft. Your responses will be kept confidential and used only for research purposes.

If you have any questions about this survey, please contact us: deyi.kong\@mail.utoronto.ca

**Section 1: General Information**

1. **What is your role in the procurement process?**  
   - Procurement Officer  
   - Project Manager  
   - Technical Specialist  
   - Other (please specify): _________

2. **How many years of experience do you have in procurement?**  
   - Less than 1 year  
   - 1–5 years  
   - 6–10 years  
   - Over 10 years  

3. **Which sector or department do you primarily represent?**  
   - National Defence  
   - Employment and Social Development Canada  
   - Natural Resources Canada  
   - Other (please specify): _________

**Section 2: Vendor Interaction and Communication**

4. **How would you describe your department’s relationship with Microsoft?**  
   - Excellent  
   - Good  
   - Neutral  
   - Poor  
   - Very Poor  

5. **How frequently does your department interact with Microsoft representatives?**  
   - Weekly  
   - Monthly  
   - Quarterly  
   - Annually  
   - As needed  

6. **What is the primary mode of communication with Microsoft?**  
   - Email  
   - Phone calls  
   - In-person meetings  
   - Online meetings (e.g., Zoom, Teams)  
   - Other (please specify): _________

**Section 3: Relationship Dynamics**

7. **To what extent does Microsoft involve your department in the decision-making process for solutions or services?**  
   - Always  
   - Often  
   - Sometimes  
   - Rarely  
   - Never  

8. **How would you rate Microsoft’s responsiveness to your department’s needs or concerns?**  
   - Very Responsive  
   - Responsive  
   - Neutral  
   - Unresponsive  
   - Very Unresponsive  

9. **Does your department feel valued as a client by Microsoft?**  
   - Strongly Agree  
   - Agree  
   - Neutral  
   - Disagree  
   - Strongly Disagree  

**Section 4: Impact of the Vendor Relationship**

10. **What is the biggest benefit of your department's relationship with Microsoft?**  
    - Access to cutting-edge technology  
    - Reliability of services  
    - Cost efficiency  
    - Strategic partnership opportunities  
    - Other (please specify): _________

11. **What challenges have you experienced in working with Microsoft? (Select all that apply)**  
    - High costs  
    - Limited customization options  
    - Slow response times  
    - Difficulty with contract negotiations  
    - Other (please specify): _________

12. **How likely are you to recommend Microsoft as a vendor to other departments?**  
    - Very Likely  
    - Likely  
    - Neutral  
    - Unlikely  
    - Very Unlikely  

**Section 5: Suggestions for Improvement**

13. **What changes would you recommend for improving the relationship with Microsoft?**  
    (Open text field)  

14. **Are there alternative vendors you believe could meet your department’s needs better than Microsoft? If so, please specify.**  
    (Open text field)  

-----

Thank you for your participation in this survey. Your feedback is invaluable in understanding and improving vendor relationships in federal procurement. If you have additional comments or would like to receive updates on the research findings, please indicate below.  
   - [\ ] Yes, I’d like to receive updates.  
   - [\ ] No, I do not wish to receive updates.  


\newpage

# References
